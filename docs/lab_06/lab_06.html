

<!DOCTYPE html>


<html lang="fr" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Laboratoire 6 — Développement de drivers kernel-space III &#8212; Documentation DRV 2024 </title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/color.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js"></script>
    <script src="../_static/translations.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lab_06/lab_06';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="prev" title="Laboratoire 5 — Développement de drivers kernel-space II" href="../lab_05/lab_05.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="fr"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Passer au contenu principal</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Haut de page</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo_drv.png" class="logo__image only-light" alt="Documentation DRV 2024  - Home"/>
    <script>document.write(`<img src="../_static/logo_drv.png" class="logo__image only-dark" alt="Documentation DRV 2024  - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Recherche" aria-label="Recherche" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Recherche</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../helper/helper.html">Helper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../helper/ssh.html">Mise en place SSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="../helper/eval_criterion.html">Consigne de rendu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab_00/lab_00.html">Laboratoire 0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab_01/lab_01.html">Laboratoire 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tuto_01/tuto_01.html">Tuto 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab_02/lab_02.html">Laboratoire 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tuto_02/tuto_02.html">Tuto 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab_03/lab_03.html">Laboratoire 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab_04/lab_04.html">Laboratoire 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tuto_03/tuto_03.html">Tuto 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab_05/lab_05.html">Laboratoire 5</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Laboratoire 6</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Téléchargez cette page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/lab_06/lab_06.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Télécharger le fichier source"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Imprimer au format PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Mode plein écran"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="clair/sombre" aria-label="clair/sombre" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Recherche" aria-label="Recherche" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Laboratoire 6 — Développement de drivers kernel-space III</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contenu </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objectifs">Objectifs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#materiel-necessaire">Matériel nécessaire</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gestion-des-interruptions">Gestion des interruptions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercice">Exercice</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fonctionnement-de-base">Fonctionnement de base</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#historique-et-char-device">Historique et <em>char device</em></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sysfs">SysFS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contraintes">Contraintes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#travail-a-rendre-et-criteres-d-evaluation">Travail à rendre et critères d’évaluation</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="laboratoire-6-developpement-de-drivers-kernel-space-iii">
<span id="laboratoire6"></span><h1>Laboratoire 6 — Développement de drivers kernel-space III<a class="headerlink" href="#laboratoire-6-developpement-de-drivers-kernel-space-iii" title="Lien permanent vers ce titre">#</a></h1>
<figure class="align-right">
<a class="reference internal image-reference" href="../_images/logo_drv.png"><img alt="../_images/logo_drv.png" src="../_images/logo_drv.png" style="width: 6cm;" /></a>
</figure>
<section id="objectifs">
<h2>Objectifs<a class="headerlink" href="#objectifs" title="Lien permanent vers ce titre">#</a></h2>
<ul class="simple">
<li><p>Faire du traitement différé des interruptions</p></li>
<li><p>Utiliser les workqueues pour faire des actions « longues durées »</p></li>
<li><p>Voir le mécanisme des listes chainées offert par le kernel</p></li>
<li><p>Voir des méthodes de gestion du temps</p></li>
</ul>
</section>
<section id="materiel-necessaire">
<h2>Matériel nécessaire<a class="headerlink" href="#materiel-necessaire" title="Lien permanent vers ce titre">#</a></h2>
<p>Ce laboratoire utilise le même environnement que le laboratoire précédent,
qui peut donc être réutilisé.</p>
</section>
<section id="gestion-des-interruptions">
<h2>Gestion des interruptions<a class="headerlink" href="#gestion-des-interruptions" title="Lien permanent vers ce titre">#</a></h2>
<p>Le mécanisme de gestion des interruptions utilisé jusqu’à présent peut s’avérer
inefficace lorsqu’on a des tâches conséquentes à réaliser pour traiter une interruption.
Par exemple, si on doit traiter une grande quantité de données suite à la pression d’un
bouton, il est évident qu’on ne peut pas effectuer ces opérations dans la routine d’interruption.
Il ne faut pas oublier non plus qu’il est <strong>interdit</strong> d’appeler dans une routine d’interruption des fonctions
qui pourraient s’endormir.</p>
<p>Vous avez vu pendant le cours plusieurs options pour repousser du travail à
l’extérieur du code de la routine d’interruption — en particulier la distinction entre
<em>top half</em> (ou <em>hard irq</em>) et <em>bottom half</em>.
Parmi ces approches, les threaded irq handlers et les workqueues sont normalement
<strong>la</strong> façon de gérer les interruptions, sauf dans de cas très spécifiques.
Dans le tableau ci-dessous, les différentes alternatives conseillées sont listées</p>
<div class="pst-scrollable-table-container"><table class="table">
<colgroup>
<col style="width: 46%" />
<col style="width: 54%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Durée IRQ handler</p></th>
<th class="head"><p>Mécanisme conséillé</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>t &lt;= 10 us</p></td>
<td><p>juste le hard irq</p></td>
</tr>
<tr class="row-odd"><td><p>10 us &lt; t &lt; 100 us</p></td>
<td><p>threaded irq handlers / workqueues</p></td>
</tr>
<tr class="row-even"><td><p>t &gt;= 100 us, non-critical code</p></td>
<td><p>threaded irq handlers / workqueues</p></td>
</tr>
<tr class="row-odd"><td><p>t &gt;= 100 us, critical code</p></td>
<td><p>tasklets</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="exercice">
<h2>Exercice<a class="headerlink" href="#exercice" title="Lien permanent vers ce titre">#</a></h2>
<p>On souhaite utiliser la carte la gestion du déroulement de match de tennis.</p>
<p>Pour rappels/informations, les règles du tennis sont les suivantes (simplifiées pour l’exercice) :</p>
<ul class="simple">
<li><p>Un match de tennis est composé de plusieurs <em>sets</em>.</p>
<ul>
<li><p>En fonction du format, il faut gagner deux ou trois <em>sets</em> pour gagner le match.</p></li>
</ul>
</li>
<li><p>Un <em>set</em> est composé de plusieurs <em>jeux</em>.</p>
<ul>
<li><p>Il faut gagner six <em>jeux</em> pour gagner un <em>set</em>.</p></li>
<li><p>Pour l’exercice, les règles des deux jeux d’écart et du <em>tie-break</em> ne seront pas prise en compte.</p></li>
</ul>
</li>
<li><p>Un <em>jeu</em> est composé de plusieurs <em>points</em>.</p>
<ul>
<li><p>Pour gagner un <em>jeu</em>, il faut gagner au moins quatre <em>points</em> et avoir deux <em>points</em> d’écart avec l’adversaire</p></li>
<li><p>Pour des raisons historiques, le score suit le <em>paterne</em> « 0 - 15 - 30 - 40 » et on parle d”<em>avantage</em> (<em>Ad</em>) au joueur
ayant gagné un point lors d’une égalité 40-40.</p></li>
</ul>
</li>
<li><p>Le joueur qui sert la balle est le même durant toute la durée d’un <em>jeu</em> et change à chaque <em>jeu</em>.</p></li>
<li><p>Les joueurs changent de côté du terrain tous les deux jeux.</p></li>
</ul>
<p>Exemple de déroulement :</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>Début du match

J1 sert
J1 gagne le point
Score (jeu) : 15-0

J1 gagne le point
Score (jeu) : 30-0

J2 gagne le point
Score (jeu) : 30-15

J1 gagne le point
Score (jeu) : 40-15

J1 gagne le point et le jeu
Score (set) : 1-0


J2 sert
...
Score (jeu) : 40-40

J2 gagne le point
Score (jeu) : -Ad

J1 gagne le point
Score (jeu) : 40-40

J1 gagne le point
Score (jeu) : Ad-

J1 gagne le point et le jeu
Score (set) : 2-0

Changement de côté
J1 sert
...
J2 gagne le jeu
Score (set) : 2-1

...

Score (set) : 5-4
J2 sert
...
J1 gagne le jeu et le set
Score (match) : 1-0

Nouveau set

...

Score (set) : 5-3

J2 sert
...
J1 gagne le jeu, le set et le match
</pre></div>
</div>
<section id="fonctionnement-de-base">
<h3>Fonctionnement de base<a class="headerlink" href="#fonctionnement-de-base" title="Lien permanent vers ce titre">#</a></h3>
<p>Implémentez un driver permettant d’utiliser la carte pour gérer les matchs selon les spécifications suivantes.</p>
<p>Par défaut, le driver est en attente d’un nouveau match et tout est éteint (7-segment et leds).
L’utilisateur doit alors appuyer sur <code class="code c docutils literal notranslate"><span class="name"><span class="pre">KEY0</span></span></code> pour démarrer un match.</p>
<p>L’affichage suivant sera utilisé durant un match :</p>
<ul class="simple">
<li><p>Les affichages 7-segments <code class="code c docutils literal notranslate"><span class="name"><span class="pre">HEX1</span></span><span class="literal number integer"><span class="pre">-0</span></span></code> et <code class="code c docutils literal notranslate"><span class="name"><span class="pre">HEX5</span></span><span class="literal number integer"><span class="pre">-4</span></span></code> affichent le score du <em>jeu</em> actuel</p>
<ul>
<li><p>En cas d’avantage (après égalité 40-40), <code class="code c docutils literal notranslate"><span class="name"><span class="pre">Ad</span></span></code> est affiché pour le joueur ayant l’avantage et <code class="code c docutils literal notranslate"><span class="operator"><span class="pre">-</span></span></code> est affiché pour l’autre</p></li>
</ul>
</li>
<li><p>Les affichages 7-segment <code class="code c docutils literal notranslate"><span class="name"><span class="pre">HEX2</span></span></code> et <code class="code c docutils literal notranslate"><span class="name"><span class="pre">HEX3</span></span></code> affichent le score du <em>set</em> actuel</p></li>
<li><p>Les leds <code class="code c docutils literal notranslate"><span class="name"><span class="pre">LED0</span></span><span class="literal number integer"><span class="pre">-2</span></span></code> et <code class="code c docutils literal notranslate"><span class="name"><span class="pre">LED7</span></span><span class="literal number integer"><span class="pre">-9</span></span></code> affichent le nombre de <em>set</em> gagné par les joueurs (le premier <em>set</em> gagné allume respectivement la LED 0 ou 9)</p></li>
<li><p>Les leds <code class="code c docutils literal notranslate"><span class="name"><span class="pre">LED4</span></span><span class="literal number integer"><span class="pre">-5</span></span></code> indiqueront qui est le serveur actuel (commence par le joueur de droite)</p></li>
</ul>
<p>Au début d’un match, le score de départ (0-0) s’affiche et il est ensuite possible d’indiquer les points gagnés à l’aide des boutons <code class="code c docutils literal notranslate"><span class="name"><span class="pre">KEY0</span></span></code> et <code class="code c docutils literal notranslate"><span class="name"><span class="pre">KEY3</span></span></code>.
La gestion des scores se fait alors automatiquement, sans autre entrée utilisateur (= détection automatique des <em>jeux/sets/match</em> gagnés).</p>
<p>Par défaut, le format est en mode deux <em>sets</em> gagnants, cette configuration se fera via un fichier <em>sysfs</em>.</p>
<p>Lorsque le match est terminé, le score du premier <em>set</em> s’affiche sur <code class="code c docutils literal notranslate"><span class="name"><span class="pre">HEX4</span></span><span class="literal number integer"><span class="pre">-5</span></span></code>, le deuxième sur <code class="code c docutils literal notranslate"><span class="name"><span class="pre">HEX3</span></span><span class="literal number integer"><span class="pre">-2</span></span></code> et le troisième sur <code class="code c docutils literal notranslate"><span class="name"><span class="pre">HEX1</span></span><span class="literal number integer"><span class="pre">-0</span></span></code>.
S’il y a plus de <em>set</em> (lors de partie en trois <em>sets</em> gagnant), l’affichage alterne toutes les trois secondes entre afficher les <em>sets</em> un à trois et les <em>sets</em> quatre et cinq.
Il faut alors appuyer sur <code class="code c docutils literal notranslate"><span class="name"><span class="pre">KEY0</span></span></code> pour remettre le driver en mode par défaut (tout éteint).</p>
<p>Durant un match plusieurs annonces doivent également être faites :</p>
<ul class="simple">
<li><p>Lorsqu’un <em>jeu</em> est gagné :</p>
<ul>
<li><p><code class="code c docutils literal notranslate"><span class="name"><span class="pre">G</span></span></code> (<em>Game</em>)</p></li>
<li><p><code class="code c docutils literal notranslate"><span class="name"><span class="pre">GS</span></span></code> (<em>Game and set</em>) : S’il s’agissait du dernier pour gagner le <em>set</em></p></li>
<li><p><code class="code c docutils literal notranslate"><span class="name"><span class="pre">GSM</span></span></code> (<em>Game, set and match</em>) : S’il s’agissait du dernier pour gagne le <em>match</em></p></li>
</ul>
</li>
<li><p>Lorsqu’un joueur peut gagner le <em>jeu</em> sur le prochain point :</p>
<ul>
<li><p><code class="code c docutils literal notranslate"><span class="name"><span class="pre">GP</span></span></code> (<em>Game point</em>)</p></li>
<li><p><code class="code c docutils literal notranslate"><span class="name"><span class="pre">SP</span></span></code> (<em>Set point</em>) : Si le joueur peut gagner le <em>set</em></p></li>
<li><p><code class="code c docutils literal notranslate"><span class="name"><span class="pre">MP</span></span></code> (<em>Match point</em>) : Si le joueur peut gagner le <em>match</em></p></li>
</ul>
</li>
<li><p><code class="code c docutils literal notranslate"><span class="name"><span class="pre">SC</span></span></code> (<em>Side change</em>) : Lors d’un changement de côté</p></li>
</ul>
<p>Ces annonces doivent être faites sur les 7-segments (lettre au plus proche) aux moments voulus (l’affichage du score est temporairement <em>caché</em>). Elles doivent être affichées pendant cinq secondes.
Si plusieurs annonces doivent s’afficher en même temps, elles devront être affichées
les unes après les autres. Les actions doivent rester possibles lors de l’affichage d’une annonce.</p>
</section>
<section id="historique-et-char-device">
<h3>Historique et <em>char device</em><a class="headerlink" href="#historique-et-char-device" title="Lien permanent vers ce titre">#</a></h3>
<p>En plus de ça, on souhaite conserver un historique des parties qui se sont déroulées.
Cet historique doit permettre de récupérer les scores de tous les matchs qui ont été joués (scores des différents <em>sets</em>)
et le nombre total de points jouer durant le match.
Si un match est en cours, celui-ci n’est pas inclus dans l’historique et le sera dès que le match est terminé.</p>
<p>Un <em>char device</em> doit être mis en place pour permettre la lecture de cet historique.</p>
<p>L’écriture doit permettre de supprimer une entrée à un indice donné.</p>
<p>Le format exact des données, que se soit pour la lecture ou l’écriture, est laissé libre, mais doit être en binaire (= pas d’ASCII).</p>
<p>Implémentez une application simple permettant d’interagir avec le <em>char device</em>. (Simple affichage des tous les scores et suppression d’un de ceux-ci)</p>
</section>
<section id="sysfs">
<h3>SysFS<a class="headerlink" href="#sysfs" title="Lien permanent vers ce titre">#</a></h3>
<p>Il doit également être possible d’accéder aux informations suivantes via des fichiers <em>sysfs</em> :</p>
<ul class="simple">
<li><p>Si un match est en cours</p></li>
<li><p>Le score du match en cours (le score des différents <em>sets</em>)</p></li>
<li><p>Le nombre total de match dans l’historique</p></li>
<li><p>Le format (deux ou trois <em>sets</em> gagnant)</p></li>
</ul>
<p>Le format doit être modifiable. Si un match est en cours, la modification sera acceptée si elle ne rend pas incohérente les scores actuels. (P.ex. passage du format 3 <em>set</em> gagnants à 2 alors que le score est de 2-2)</p>
<p>Lorsque aucun match n’est en cours, il doit être possible de démarrer un match avec un score prédéfini en écrivant dans le fichier permettant de récupérer le score du match courant.
L’écriture sera refusée si un match est en cours ou que les données reçues sont incohérentes (p. ex. deux <em>sets</em> sont fournis, mais le premier des deux n’est pas fini).</p>
</section>
<section id="contraintes">
<h3>Contraintes<a class="headerlink" href="#contraintes" title="Lien permanent vers ce titre">#</a></h3>
<p>Les contraintes suivantes devront être respectée :</p>
<ul class="simple">
<li><p>L’historique des matchs doit utiliser une liste chainée (<code class="code c docutils literal notranslate"><span class="name"><span class="pre">list_head</span></span></code>) de Linux (<a class="reference external" href="https://www.cs.wm.edu/~smherwig/courses/csci415-common/list/index.html">exemples d’utilisation</a>
(attention, les exemples sont pour le userspace, mais basé sur l’implémentation du kernel), <a class="reference external" href="https://www.kernel.org/doc/html/v6.1/core-api/kernel-api.html#list-management-functions">api complète</a>).</p></li>
<li><p>La routine d’interruption principale pour les boutons ne doit que lire le bouton appuyé et réinitialisé le registre d’interruption. Une <em>threaded irq</em> devra être utilisée
pour effectuer la logique nécessaire liée au bouton. (<a class="reference external" href="https://github.com/ANSANJAY/KernelThreadedIRQ/blob/main/4_example/hello.c">exemple d’utilisation</a>)</p></li>
<li><p>L’affichage des annonces doit utiliser une <em>workqueue</em>. Un nouveau <em>work</em> doit être créé pour chaque annonce (lancer par la <em>threaded irq</em>).
(<a class="reference external" href="https://linux-kernel-labs.github.io/refs/heads/master/labs/deferred_work.html#workqueues">petite documentation</a>, <a class="reference external" href="https://www.kernel.org/doc/html/v6.1/core-api/workqueue.html">documentation complète du fonctionnement et de l’api</a>)</p></li>
<li><p>Tous les accès concurrents potentiels aux variables/ressources doivent être protégés correctement.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Il est possible d’utiliser la fonction <code class="code c docutils literal notranslate"><span class="name"><span class="pre">msleep</span></span><span class="punctuation"><span class="pre">()</span></span></code> dans <code class="file docutils literal notranslate"><span class="pre">linux/delay.h</span></code> pour attendre un temps donner dans le kernel.</p>
</div>
</section>
</section>
<section id="travail-a-rendre-et-criteres-d-evaluation">
<h2>Travail à rendre et critères d’évaluation<a class="headerlink" href="#travail-a-rendre-et-criteres-d-evaluation" title="Lien permanent vers ce titre">#</a></h2>
<p>S’il est demandé d’écrire du code, ce code doit se trouver dans un fichier <em>ex&lt;n&gt;.c</em>, où &lt;n&gt; correspond au numéro de l’exercice.
Si un exercice contient plusieurs variantes, alors le fichier sera nommé <em>ex&lt;n&gt;_&lt;variante&gt;.c</em>, où &lt;variante&gt; correspond à la variante.
Par exemple : <em>ex2.c</em>, <em>ex6_poll.c</em>.
Il n’est pas nécessaire de renommer les fichiers déjà existants.
Si un exercice réutilise un fichier précédent, celui-ci doit être dupliqué pour le nouvel exercice, sauf indication contraire.</p>
<p>Si le code a pour but d’être exécuté sur la DE1-SoC, il doit être compilé en « compilation croisée »,
c.-à-d. en utilisant la toolchain mentionnée dans le <a class="reference internal" href="../lab_01/lab_01.html#laboratoire1"><span class="std std-ref">Laboratoire 1 — Introduction</span></a>.</p>
<p>N’oubliez pas de mettre votre prénom et nom !</p>
<p>Les exercices sont à faire <strong>individuellement</strong>.
Copier la solution d’un autre et changer le nom/l’ordre des variables n’est pas toléré.</p>
<p>La date limite est celle communiquée dans l’annonce sur Moodle.
Vous devez rendre une archive <code class="file docutils literal notranslate"><span class="pre">.tar.gz</span></code> contenant :</p>
<ul class="simple">
<li><p>le code source de vos solutions et tous les fichiers nécessaires,</p></li>
<li><dl class="simple">
<dt>un fichier <code class="file docutils literal notranslate"><span class="pre">README.md</span></code></dt><dd><ul>
<li><p>contenant les réponses aux questions posées dans les exercices.</p></li>
<li><p>les éventuels soucis rencontrés qui péjore le rendu</p></li>
<li><p>les choix d’implémentation « spéciaux » (si trop long pour expliquer en commentaire)</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Les notes seront réparties comme suit :</p>
<ul class="simple">
<li><p>80% de la note si l’exercice est correct (c.-à-d., <em>« fonctionne »</em>).
Il doit bien sûr « fonctionner » sur d’autres PCs que votre PC personnel, et de façon déterministe.
Il est donc impératif que tout ce qui est nécessaire pour compiler et tester le fonctionnement de la solution soit rendu.</p></li>
<li><p>20% de la note si l’exercice est « bien fait », c.-à-d. :</p>
<ul>
<li><p>Respect des <a class="reference external" href="https://www.kernel.org/doc/html/latest/process/coding-style.html">Linux kernel coding style</a>,
particulièrement les points suivants :</p>
<ul>
<li><ol class="arabic simple">
<li><p>Indentation</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="2">
<li><p>Breaking long lines and strings</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="3">
<li><p>Placing Braces and Spaces</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="4">
<li><p>Naming</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="6">
<li><p>Functions</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="8">
<li><p>Commenting</p></li>
</ol>
</li>
</ul>
</li>
<li><p><strong>code lisible</strong></p></li>
<li><p><strong>documenté/commenté</strong></p></li>
<li><p><strong>bien structuré</strong></p></li>
</ul>
</li>
</ul>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../lab_05/lab_05.html"
       title="page précédente">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">précédent</p>
        <p class="prev-next-title">Laboratoire 5 — Développement de drivers kernel-space II</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contenu
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objectifs">Objectifs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#materiel-necessaire">Matériel nécessaire</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gestion-des-interruptions">Gestion des interruptions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercice">Exercice</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fonctionnement-de-base">Fonctionnement de base</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#historique-et-char-device">Historique et <em>char device</em></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sysfs">SysFS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contraintes">Contraintes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#travail-a-rendre-et-criteres-d-evaluation">Travail à rendre et critères d’évaluation</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
Par REDS institute
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024, REDS institute.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>